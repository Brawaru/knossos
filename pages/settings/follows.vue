<template>
  <div v-if="$user.follows.length > 0">
    <ProjectCard
      v-for="project in $user.follows"
      :id="project.id"
      :key="project.id"
      :type="project.project_type"
      :categories="project.categories"
      :created-at="project.published"
      :updated-at="project.updated"
      :description="project.description"
      :downloads="project.downloads ? project.downloads.toString() : '0'"
      :icon-url="project.icon_url"
      :name="project.title"
      :client-side="project.client_side"
      :server-side="project.server_side"
    >
      <button
        class="iconified-button"
        @click="$store.dispatch('user/unfollowProject', project)"
      >
        <HeartIcon />
        {{ $t('project.action.unfollow') }}
      </button>
    </ProjectCard>
  </div>
  <div v-else class="error">
    <FollowIllustration class="icon" />
    <br />
    <span class="text">
      <IntlFormatted message-id="settings.follows.empty">
        <template #search-link="{ children }">
          <nuxt-link class="link" to="/mods">
            <Fragment :of="children" />
          </nuxt-link>
        </template>
      </IntlFormatted>
    </span>
  </div>
</template>

<script>
import ProjectCard from '~/components/ui/ProjectCard'

import HeartIcon from '~/assets/images/utils/heart.svg?inline'
import FollowIllustration from '~/assets/images/illustrations/follow_illustration.svg?inline'

export default {
  components: {
    ProjectCard,
    HeartIcon,
    FollowIllustration,
  },
  async fetch() {
    await this.$store.dispatch('user/fetchFollows')
  },
  head() {
    return {
      title: this.$t('generic.meta.page-title', {
        page: this.$t('settings.follows.title'),
      }),
    }
  },
}
</script>
<style lang="scss" scoped>
.error.text {
  white-space: pre-wrap;
}
</style>
